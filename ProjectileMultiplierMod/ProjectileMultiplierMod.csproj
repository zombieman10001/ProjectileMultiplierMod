<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net6.0</TargetFramework>
    <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
    <OutputPath>bin\Win64_Shipping_Client\</OutputPath>
    <LangVersion>latest</LangVersion>
    <Nullable>enable</Nullable>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <AssemblyName>ProjectileMultiplierMod</AssemblyName>
    <RootNamespace>ProjectileMultiplierMod</RootNamespace>
    <PlatformTarget>x64</PlatformTarget>
    <Prefer32Bit>false</Prefer32Bit>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
  </PropertyGroup>

  <!-- Bannerlord installation path - can be overridden with environment variable -->
  <PropertyGroup>
    <BannerlordPath Condition="'$(BannerlordPath)' == ''">C:\Program Files (x86)\Steam\steamapps\common\Mount &amp; Blade II Bannerlord</BannerlordPath>
  </PropertyGroup>

  <ItemGroup>
    <!-- Game DLLs (compile-only) -->
    <Reference Include="TaleWorlds.MountAndBlade">
      <HintPath>$(BannerlordPath)\bin\Win64_Shipping_Client\TaleWorlds.MountAndBlade.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="TaleWorlds.Engine">
      <HintPath>$(BannerlordPath)\bin\Win64_Shipping_Client\TaleWorlds.Engine.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="TaleWorlds.Core">
      <HintPath>$(BannerlordPath)\bin\Win64_Shipping_Client\TaleWorlds.Core.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="TaleWorlds.Library">
      <HintPath>$(BannerlordPath)\bin\Win64_Shipping_Client\TaleWorlds.Library.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="TaleWorlds.DotNet">
      <HintPath>$(BannerlordPath)\bin\Win64_Shipping_Client\TaleWorlds.DotNet.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <!-- Harmony (from Harmony module - Bannerlord loads it from there) -->
    <Reference Include="0Harmony">
      <HintPath>$(BannerlordPath)\Modules\Harmony\bin\Win64_Shipping_Client\0Harmony.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <!-- MCM v5 (from MBOptionScreen module - Bannerlord loads it from there) -->
    <Reference Include="MCMv5">
      <HintPath>$(BannerlordPath)\Modules\Bannerlord.MBOptionScreen\bin\Win64_Shipping_Client\MCMv5.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="MCMv5.UI">
      <HintPath>$(BannerlordPath)\Modules\Bannerlord.MBOptionScreen\bin\Win64_Shipping_Client\MCMv5.UI.dll</HintPath>
      <Private>false</Private>
    </Reference>
  </ItemGroup>

  <ItemGroup>
    <None Include="SubModule.xml" CopyToOutputDirectory="Never" />
  </ItemGroup>

  <!-- Ensure SubModule.xml resides in the module root (not in bin) -->
  <Target Name="CopySubModuleXmlToModuleRoot" AfterTargets="Build">
    <PropertyGroup>
      <ModuleRoot>$(OutputPath)..\..\</ModuleRoot>
    </PropertyGroup>
    <Message Text="Copying SubModule.xml to $(ModuleRoot)" Importance="Low" />
    <Copy SourceFiles="SubModule.xml" DestinationFolder="$(ModuleRoot)" SkipUnchangedFiles="true" />
  </Target>
</Project>